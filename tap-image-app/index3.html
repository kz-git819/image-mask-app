<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>画像問題アプリ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }

    .image-container {
      position: relative;
      display: inline-block;
      border: 2px solid #333;
      margin-bottom: 20px;
    }

    img {
      display: block;
      width: 500px;
      height: auto;
    }

    .overlay {
      position: absolute;
      background-color: rgba(0, 0, 0, 0);
      z-index: 10;
      cursor: pointer;
      transition: background-color 0.2s;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .overlay.hidden {
      background-color: rgba(0, 0, 0, 1);
    }

    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1 id="title">第1問目</h1>

<div class="image-container" id="container">
  <img id="mainImage" src="image1.jpg" alt="画像">
</div>

<div>
  <button id="lockBtn">🔒 ロック切替</button>
  <button id="hideAllBtn">🕶 すべて隠す</button>
  <button id="showAllBtn">🧼 すべて表示</button>
  <button id="nextBtn">➡️ 次の画像</button>
</div>

<script>
  window.onload = function () {
    const container = document.getElementById('container');
    const image = document.getElementById('mainImage');
    const title = document.getElementById('title');
    const lockBtn = document.getElementById('lockBtn');
    const nextBtn = document.getElementById('nextBtn');
    const hideAllBtn = document.getElementById('hideAllBtn');
    const showAllBtn = document.getElementById('showAllBtn');

    const imageList = [
      { src: 'image1.jpg', rows: 3, cols: 5 },
      { src: 'image2.jpg', rows: 4, cols: 4 },
      { src: 'image3.jpg', rows: 2, cols: 6 }
    ];

    let currentImageIndex = 0;
    let isLocked = false;
    let overlays = [];

    function updateTitle() {
      title.textContent = `第${currentImageIndex + 1}問目`;
    }

    function createOverlays(imgWidth, imgHeight, rows, cols) {
      overlays.forEach(o => o.remove());
      overlays = [];

      const overlayWidth = imgWidth / cols;
      const overlayHeight = imgHeight / rows;

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const overlay = document.createElement('div');
          overlay.className = 'overlay';
          overlay.style.left = `${x * overlayWidth}px`;
          overlay.style.top = `${y * overlayHeight}px`;
          overlay.style.width = `${overlayWidth}px`;
          overlay.style.height = `${overlayHeight}px`;

          overlay.addEventListener('click', () => {
            if (!isLocked) {
              overlay.classList.toggle('hidden');
            }
          });

          container.appendChild(overlay);
          overlays.push(overlay);
        }
      }
    }

    function loadImage(index) {
      const imgData = imageList[index];
      image.src = imgData.src;
      updateTitle();

      image.onload = function () {
        const width = image.clientWidth;
        const height = image.clientHeight;
        createOverlays(width, height, imgData.rows, imgData.cols);
      };
    }

    lockBtn.addEventListener('click', () => {
      isLocked = !isLocked;
      alert(isLocked ? "ロックされました" : "ロック解除されました");
    });

    nextBtn.addEventListener('click', () => {
      currentImageIndex = (currentImageIndex + 1) % imageList.length;
      loadImage(currentImageIndex);
    });

    hideAllBtn.addEventListener('click', () => {
      if (!isLocked) {
        overlays.forEach(o => o.classList.add('hidden'));
      } else {
        alert("ロック中です。ロックを解除してから実行してください。");
      }
    });

    showAllBtn.addEventListener('click', () => {
      if (!isLocked) {
        overlays.forEach(o => o.classList.remove('hidden'));
      } else {
        alert("ロック中です。ロックを解除してから実行してください。");
      }
    });

    // 初期表示
    loadImage(currentImageIndex);
  };
</script>

</body>
</html>
